#!/usr/bin/env bash
FG='\033[37m'
BG1='\033[45m';
BG2='\033[46m';
BG3='\033[43m';
NC='\033[0m'

dir=$(basename "$(pwd)")
declare -A config

case $dir in
  laradock)
    config=( ['container']='workspace' ['params']='-u laradock -w /var/www/laravel')
    ;;

  *)
    config=( ['container']='web' ['params']='')
esac

command=$(printf '%q ' "$@")
wrapperCommand="source ~/.bashrc; $command"

# Upper decoration:
echo -n    "┌──"
echo -n    "docker compose exec " | sed 's/./─/g'
echo -n    ${config[params]} | sed 's/./─/g'
echo -n    ${config[container]}' ' | sed 's/./─/g'
echo -n    "bash -ic \"" | sed 's/./─/g'
echo -n    $wrapperCommand | sed 's/./─/g'
echo       "┐" 
# Middle:
echo -ne   "│"
echo -n    "docker compose exec " 
echo -n    ${config[params]}
echo -n    ${config[container]}' '
echo -ne   "${FG}${BG2}bash -ic \"${BG3}source ~/.bashrc;${BG1} "
echo -n    $command
echo -n    " "
echo -e    "${BG2}\"${NC}│"
# Lower decoration:
echo -ne   "└──"
echo -n    "docker compose exec " | sed 's/./─/g'
echo -n    ${config[params]} | sed 's/./─/g'
echo -n    ${config[container]}' ' | sed 's/./─/g'
echo -n    "bash -ic \"" | sed 's/./─/g'
echo -n    $wrapperCommand | sed 's/./─/g'
echo -e    "┘\n" 

# Word splitting is intentional.
# shellcheck disable=SC2086
docker compose exec ${config[params]} ${config[container]} bash -ic "$wrapperCommand"
