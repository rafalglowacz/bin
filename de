#!/usr/bin/env bash
WHITE_FG='\033[37m'

LIGHT_GREY_FG='\033[38;5;255m';
LIGHT_GREY_BG='\033[48;5;255m';

BLACK_FG='\033[30m';

MAGENTA_FG='\033[35m';
MAGENTA_BG='\033[45m';

CYAN_FG='\033[36m';
CYAN_BG='\033[46m';

NC='\033[0m'

# For custom config, copy the contents of the "else" block below 
# to ~/.de-config and change to your needs.
if [ -f ~/.de-config ]; then 
  source ~/.de-config
else
  dir=$(basename "$(pwd)")
  declare -A config

  case $dir in
    laradock)
      config=( ['container']='workspace' ['params']='-u laradock -w /var/www/laravel')
      ;;

    *)
      config=( ['container']='web' ['params']='')
  esac
fi

command=$(printf '%q ' "$@")
wrapperCommand="source ~/.bashrc; $command"

echo -ne   "${LIGHT_GREY_FG}${NC}${LIGHT_GREY_BG}${BLACK_FG}"
echo -ne   "docker compose exec " 
echo -n    ${config[params]} ${config[container]}' '
echo -ne   "${LIGHT_GREY_BG}${CYAN_FG}"
echo -ne   "${BLACK_FG}${CYAN_BG}bash -ic \"source ~/.bashrc;"
echo -ne   "${CYAN_BG}${MAGENTA_FG}${MAGENTA_BG}${WHITE_FG}" 
echo -n    $command
echo -ne   "${CYAN_BG}${MAGENTA_FG}"
echo -ne   "${BLACK_FG}\"${LIGHT_GREY_BG}${CYAN_FG}${NC}"
echo -e    "${LIGHT_GREY_FG}${NC}\n"

# Word splitting is intentional.
# shellcheck disable=SC2086
docker compose exec ${config[params]} ${config[container]} bash -ic "$wrapperCommand"
